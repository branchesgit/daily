{"version":3,"file":"bundle.js","sources":["../src/promise.js","../src/event.js","../src/main.js"],"sourcesContent":["export default function EasyPromise(callback) {\n    this.resolveObj = createCallbacks();\n    this.rejectObj = createCallbacks();\n    this.value;\n    this.reason;\n    this.status = \"pending\";\n    this.innerResolve = value => {\n        this.value = value;\n        setTimeout(() => this.resolveObj.resolve(value), 0);\n    }\n\n    this.innerReject = reason => {\n        this.reason = reason;\n        setTimeout(() => this.rejectObj.resove(reason), 0);\n    }\n\n    callback && callback(this.innerResolve, this.innerReject)\n}\n\nEasyPromise.prototype.then = function (onResolved, onRejected) {\n    if (this.isPending()) {\n        return new EasyPromise((resolve, reject) => {\n            // waiting for promise.resolve.\n            this.resolveObj.add(() => {\n                const res = onResolved(this.value)\n                if (res instanceof EasyPromise) {\n                    res.then(resolve)\n                } else {\n                    resolve(res)\n                }\n            })\n        });\n    } else if (this.isResolved()) {\n        onResolved(this.value);\n        return this;\n    } else if (thi.isRejected()) {\n        onRejected(this.reason)\n        return this;\n    }\n}\n\nEasyPromise.prototype.resolve = function (value) {\n    this.resolved();\n    this.innerResolved(value);\n}\n\nEasyPromise.prototype.reject = function () {\n\n}\n\nEasyPromise.prototype.isPending = function () {\n    return this.status === \"pending\"\n}\n\nEasyPromise.prototype.isResolved = function () {\n    return this.status === \"resolved\"\n}\n\nEasyPromise.prototype.isRejected = function () {\n    return this.status === \"rejected\"\n}\n\nEasyPromise.prototype.rejected = function () {\n    this.status = \"rejected\"\n}\n\nEasyPromise.prototype.resolved = function () {\n    this.status = \"resolved\"\n}\n\nfunction createCallbacks() {\n    const fns = [];\n\n    function add() {\n        const args = Array.prototype.slice.call(arguments);\n        for (let i = 0; i < args.length; i++) {\n            fns.push(args[i])\n        }\n    }\n\n    function remove() {\n        const args = Array.prototype.slice.call(arguments);\n        for (let i = 0; i < args.length; i++) {\n            const idx = fns.findIndex(fn => fn === args[i]);\n            if (idx !== -1) {\n                fns.splice(idx, 1);\n            }\n        }\n    }\n\n    function resolve(value) {\n        fns.map(fn => fn(value));\n    }\n\n    return {\n        add,\n        remove,\n        resolve,\n    }\n\n}","let guid = 1;\n\nexport function addEvent(element, type, handler) {\n    if(!element.events) {\n        element.events = {};\n    }\n\n    if (!handler.guid) {\n        handler.guid = guid++;\n    }\n\n    const handlers = (element.events[type] || (element.events[type] = {}))\n    if (element[`on${type}`]) {\n        handlers[`0`] = element[`on${type}`]\n    }\n    \n    handlers[handler.guid] = handler\n\n    element[`on${type}`] = handleEvent;\n}\n\nexport function removeEvent(element, type, handler) {\n    const handlers = element && element.events && element.events[type];\n    if (handlers) {\n        const guid = handler.guid;\n        if (guid in handlers) {\n            delete handlers[guid];\n        }\n    }\n}\n\nfunction handleEvent(event) {\n    event = event || window.event;\n    const handlers = this.events[event.type];\n\n    for(let i in handlers) {\n        this.handleEvent = handlers[i]\n        this.handleEvent(event)        \n    }\n\n}","document.write('<script src=\"http://' \n                 + (location.host || 'localhost').split(':')[0] +\n                 ':5729/livereload.js?snipver=1\"></' + 'script>');\n\n\n\nimport MyPromise from \"./promise\"\nimport { addEvent, removeEvent } from \"./event\";\nfunction onload() {\n    const promise = new MyPromise((resolve, reject) => {\n       const p = fetch(\"./json/a.json\").then(res => res.json());\n       p.then(data => {\n        console.log('a', data)\n        resolve(data)\n       })\n    });\n\n    promise.then(value => {\n        console.log(value, 'value')\n        const p1 = new MyPromise((resolve, reject) => {\n            const p = fetch(`./json/b.json?v=${value.result}`).then(res => res.json())\n            p.then(data => {\n                console.log(data, 'b')\n                resolve(data)\n            })\n        })\n        return p1; \n    });\n}\n\nwindow.addEventListener('load', onload, false);\n\n(function() {\n    const button = document.body.querySelector(\"button\");\n    function onButtonClick() {\n        console.log('on button click')\n        removeEvent(button, 'click', onButtonClick)\n    }\n    addEvent(button, 'click', onButtonClick)\n\n    window.handleClick = () => {\n        console.log('self click')\n    }\n})();"],"names":["EasyPromise","callback","resolveObj","createCallbacks","rejectObj","value","reason","status","innerResolve","setTimeout","resolve","innerReject","resove","prototype","then","onResolved","onRejected","isPending","reject","add","res","isResolved","thi","isRejected","resolved","innerResolved","rejected","fns","args","Array","slice","call","arguments","i","length","push","remove","idx","findIndex","fn","splice","map","guid","addEvent","element","type","handler","events","handlers","handleEvent","removeEvent","event","window","document","write","location","host","split","onload","promise","MyPromise","p","fetch","json","console","log","data","p1","result","addEventListener","button","body","querySelector","onButtonClick","handleClick"],"mappings":"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"}